# DANGA (danga.site) — Vibe Coding A~Z 진행 문서

## Part 9: 마이페이지(ME) 고도화 — 내 글/내 좋아요/내 댓글 + 프로필 편집 + 탈퇴(Soft Delete)

> Part 9는 “사용자가 머무를 이유”를 강화합니다.  
> 내가 올린 것, 내가 반응한 것, 내가 남긴 흔적을 한 곳에서 보게 하면 재방문이 올라갑니다.

---

## 0. 전제(Part 8까지 완료)

- ✅ Auth + profiles
- ✅ posts + feed + detail
- ✅ votes(좋아요)
- ✅ comments(댓글)
- ✅ rankings(주/월)
- ✅ 운영(danga.site)에서 기본 동작 확인

---

## 1. Part 9 목표

1. `/me` 페이지에 탭 3개:
   - **내 글**
   - **내 좋아요**
   - **내 댓글**
2. 프로필 편집:
   - nickname 변경
   - (선택) avatar_url 변경(텍스트 URL만 MVP로 허용)
3. 탈퇴(soft delete):
   - `profiles.deleted_at = now()` 처리
   - 탈퇴 후 로그아웃 + 랜딩 이동
4. 기본 UX:
   - 로그인 안 했으면 로그인 유도
   - 로딩/빈 상태/에러 상태 처리

---

## 2. 데이터 정의(마이페이지에 보여줄 것)

### 2.1 내 글(My Posts)

- `posts.user_id = auth.uid()`
- `posts.deleted_at is null`
- 최신순

### 2.2 내 좋아요(Posts I Liked)

- `votes.voter_id = auth.uid()`
- votes에서 post_id 목록 → posts in() 조회
- posts.deleted_at is null
- 최신순(가능하면 votes.created_at desc 기준)

### 2.3 내 댓글(My Comments)

- `comments.user_id = auth.uid()`
- `comments.deleted_at is null`
- 최신순
- 댓글 본문 + 해당 게시글 링크(`/p/[id]`)

---

## 3. DB 변경(필수/선택)

### 3.1 필수: profiles는 이미 deleted_at 컬럼이 있어야 함

- Part 3에서 profiles에 deleted_at이 이미 들어가 있음(전제)
- 없다면 아래 SQL로 추가:

```sql
alter table public.profiles
add column if not exists deleted_at timestamptz;
```
